<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi Mobile - Install di HP</title>
    <!-- PWA Configuration -->
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Absensi Guru">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Absensi Guru">
    
    <!-- PWA Manifest -->
    <link rel="manifest" id="manifest-placeholder">
    
    <!-- App Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMzQjgyRjYiLz4KPHBhdGggZD0iTTQ4IDY0SDE0NFY4MEg0OFY2NFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik00OCA5NkgxNDRWMTEySDQ4Vjk2WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTQ4IDEyOEgxMTJWMTQ0SDQ4VjEyOFoiIGZpbGw9IndoaXRlIi8+CjxjaXJjbGUgY3g9IjE0NCIgY3k9IjEzNiIgcj0iMTYiIGZpbGw9IiMxMEI5ODEiLz4KPHBhdGggZD0iTTEzNiAxMzZMMTQwIDE0MEwxNTIgMTI4IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjMiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMzQjgyRjYiLz4KPHBhdGggZD0iTTQ4IDY0SDE0NFY4MEg0OFY2NFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik00OCA5NkgxNDRWMTEySDQ4Vjk2WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTQ4IDEyOEgxMTJWMTQ0SDQ4VjEyOFoiIGZpbGw9IndoaXRlIi8+CjxjaXJjbGUgY3g9IjE0NCIgY3k9IjEzNiIgcj0iMTYiIGZpbGw9IiMxMEI5ODEiLz4KPHBhdGggZD0iTTEzNiAxMzZMMTQwIDE0MEwxNTIgMTI4IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjMiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .scanner-line {
            animation: scan 2s linear infinite;
        }
        @keyframes scan {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(300%); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">📱 Absensi Mobile</h1>
            <p class="text-gray-600">Install aplikasi di HP untuk absensi mudah</p>
            
            <!-- Install App Button -->
            <div id="installPrompt" class="hidden mt-4">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto">
                    <div class="flex items-center gap-3 mb-3">
                        <span class="text-2xl">📲</span>
                        <div class="text-left">
                            <h3 class="font-bold text-blue-800">Install Aplikasi</h3>
                            <p class="text-blue-700 text-sm">Tambahkan ke layar utama HP</p>
                        </div>
                    </div>
                    <button id="installButton" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                        📱 Install Sekarang
                    </button>
                </div>
            </div>
            
            <!-- Manual Install Instructions -->
            <div id="manualInstall" class="mt-4">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 max-w-md mx-auto">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-green-600">💡</span>
                        <h3 class="font-bold text-green-800">Cara Install di HP</h3>
                    </div>
                    <div class="text-left text-sm text-green-700 space-y-3">
                        <div>
                            <div class="font-semibold mb-1">📱 Android (Chrome/Edge):</div>
                            <div class="ml-2 space-y-1">
                                <div>1. Buka link ini di browser HP</div>
                                <div>2. Tap menu (⋮) di pojok kanan atas</div>
                                <div>3. Pilih "Tambahkan ke layar utama"</div>
                                <div>4. Tap "Tambah" untuk konfirmasi</div>
                            </div>
                        </div>
                        <div>
                            <div class="font-semibold mb-1">🍎 iPhone (Safari):</div>
                            <div class="ml-2 space-y-1">
                                <div>1. Buka link ini di Safari</div>
                                <div>2. Tap tombol bagikan (📤) di bawah</div>
                                <div>3. Scroll dan pilih "Tambah ke Layar Utama"</div>
                                <div>4. Tap "Tambah" untuk konfirmasi</div>
                            </div>
                        </div>
                        <div class="bg-green-100 p-2 rounded text-xs">
                            <strong>✅ Setelah install:</strong> Aplikasi akan muncul di layar utama HP seperti aplikasi lainnya dan bisa digunakan offline!
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PWA Status -->
            <div class="mt-4">
                <div id="pwaStatus" class="bg-purple-50 border border-purple-200 rounded-lg p-4 max-w-md mx-auto mb-3">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-purple-600" id="pwaIcon">⚡</span>
                        <span class="font-medium text-purple-800" id="pwaTitle">Status PWA</span>
                    </div>
                    <div class="text-sm text-purple-700 mb-3" id="pwaMessage">
                        Aplikasi siap di-install sebagai PWA!
                    </div>
                    
                    <div class="bg-white p-3 rounded border text-xs text-gray-700 mb-3" id="pwaDetails">
                        <div class="font-semibold mb-2">📋 FITUR PWA:</div>
                        <div id="pwaFeatures">
                            ✅ Manifest file: Aktif<br>
                            ✅ Service Worker: Aktif<br>
                            ✅ Offline support: Aktif<br>
                            ✅ Install prompt: Siap
                        </div>
                    </div>
                    
                    <div class="text-xs text-purple-600" id="pwaNote">
                        Aplikasi ini dapat berjalan seperti aplikasi native
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex justify-center mb-8">
            <div class="bg-white rounded-lg p-1 shadow-lg flex flex-wrap" id="mainTabs">
                <button id="absenTab" class="px-4 py-2 rounded-md font-medium transition-all duration-200 bg-blue-500 text-white text-sm">
                    📱 Absen Saya
                </button>
                <button id="historyTab" class="px-4 py-2 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-blue-500 text-sm">
                    📋 Riwayat
                </button>
                <button id="profileTab" class="px-4 py-2 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-blue-500 text-sm">
                    👤 Profil
                </button>
            </div>
            
            <!-- Admin Tabs (Hidden by default) -->
            <div class="bg-white rounded-lg p-1 shadow-lg flex flex-wrap hidden" id="adminTabs">
                <button id="scanTab" class="px-4 py-2 rounded-md font-medium transition-all duration-200 bg-blue-500 text-white text-sm">
                    📷 Scan Absen
                </button>
                <button id="generateTab" class="px-4 py-2 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-blue-500 text-sm">
                    🏷️ Buat Barcode
                </button>
                <button id="reportTab" class="px-4 py-2 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-blue-500 text-sm">
                    📊 Laporan
                </button>
                <button id="settingsTab" class="px-4 py-2 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-blue-500 text-sm bg-yellow-50 border border-yellow-200">
                    ⚙️ Pengaturan
                </button>
            </div>
        </div>

        <!-- Teacher Attendance Section -->
        <div id="absenSection" class="max-w-2xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">📱 Absen Guru</h2>
                
                <!-- Teacher Profile Setup -->
                <div id="teacherSetup" class="mb-6">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <h3 class="font-bold text-blue-800 mb-3">👤 Data Guru</h3>
                        <div class="space-y-3">
                            <input type="text" id="teacherName" placeholder="Nama lengkap" 
                                   class="w-full px-4 py-2 border border-blue-300 rounded-lg">
                            <input type="text" id="teacherSubject" placeholder="Mata pelajaran" 
                                   class="w-full px-4 py-2 border border-blue-300 rounded-lg">
                            <input type="text" id="teacherNIP" placeholder="NIP (opsional)" 
                                   class="w-full px-4 py-2 border border-blue-300 rounded-lg">
                            <button id="saveTeacherProfile" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                                💾 Simpan Profil
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Attendance -->
                <div id="quickAttendance" class="hidden">
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-6 mb-4">
                        <div class="text-center mb-4">
                            <div class="text-3xl mb-2">👋</div>
                            <h3 class="text-xl font-bold text-gray-800" id="welcomeMessage">Selamat datang!</h3>
                            <p class="text-gray-600" id="teacherInfo">Guru</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <button id="absenMasuk" class="bg-green-500 text-white py-4 rounded-lg hover:bg-green-600 transition-colors font-medium">
                                🌅 Absen Masuk
                            </button>
                            <button id="absenPulang" class="bg-blue-500 text-white py-4 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                                🌆 Absen Pulang
                            </button>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <div class="text-sm text-gray-600">
                                <div id="currentTime" class="font-medium"></div>
                                <div id="locationStatus" class="text-xs mt-1">📍 Lokasi siap</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Today's Status -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">📅 Status Hari Ini</h3>
                <div id="todayStatus" class="space-y-3">
                    <div class="text-gray-500 text-center py-4">Belum ada absensi hari ini</div>
                </div>
            </div>
        </div>

        <!-- Teacher History Section -->
        <div id="historySection" class="max-w-2xl mx-auto hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">📋 Riwayat Absensi</h2>
                
                <!-- Statistics -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-green-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-green-600" id="totalHadir">0</div>
                        <div class="text-green-800 text-sm">Hari Hadir</div>
                    </div>
                    <div class="bg-orange-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-orange-600" id="totalTerlambat">0</div>
                        <div class="text-orange-800 text-sm">Terlambat</div>
                    </div>
                </div>
                
                <!-- History List -->
                <div id="historyList" class="space-y-3">
                    <div class="text-gray-500 text-center py-4">Belum ada riwayat absensi</div>
                </div>
            </div>
        </div>

        <!-- Teacher Profile Section -->
        <div id="profileSection" class="max-w-2xl mx-auto hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">👤 Profil Guru</h2>
                
                <div class="space-y-6">
                    <!-- Profile Info -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="font-bold text-gray-800 mb-3">Informasi Pribadi</h3>
                        <div id="profileInfo" class="space-y-2 text-sm">
                            <div class="text-gray-500">Belum ada profil tersimpan</div>
                        </div>
                    </div>
                    
                    <!-- Edit Profile -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-bold text-blue-800 mb-3">Edit Profil</h3>
                        <div class="space-y-3">
                            <input type="text" id="editTeacherName" placeholder="Nama lengkap" 
                                   class="w-full px-4 py-2 border border-blue-300 rounded-lg">
                            <input type="text" id="editTeacherSubject" placeholder="Mata pelajaran" 
                                   class="w-full px-4 py-2 border border-blue-300 rounded-lg">
                            <input type="text" id="editTeacherNIP" placeholder="NIP (opsional)" 
                                   class="w-full px-4 py-2 border border-blue-300 rounded-lg">
                            <button id="updateProfile" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                                💾 Update Profil
                            </button>
                        </div>
                    </div>
                    
                    <!-- Share Link -->
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4">
                        <h3 class="font-bold text-purple-800 mb-3">📤 Bagikan Link Absensi</h3>
                        <div class="space-y-3">
                            <div class="bg-white p-3 rounded border text-sm">
                                <div class="font-medium text-gray-700 mb-2">Link Aplikasi:</div>
                                <div id="appLink" class="text-blue-600 break-all text-xs bg-gray-50 p-2 rounded"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button id="copyLink" class="bg-purple-500 text-white py-2 px-3 rounded-lg hover:bg-purple-600 transition-colors text-sm font-medium">
                                    📋 Salin Link
                                </button>
                                <button id="shareLink" class="bg-green-500 text-white py-2 px-3 rounded-lg hover:bg-green-600 transition-colors text-sm font-medium">
                                    📱 Bagikan
                                </button>
                            </div>
                            <div class="text-xs text-purple-700">
                                💡 Bagikan link ini ke guru agar mereka bisa mengakses aplikasi absensi
                            </div>
                        </div>
                    </div>

                    <!-- App Info -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h3 class="font-bold text-green-800 mb-3">Informasi Aplikasi</h3>
                        <div class="text-sm text-green-700 space-y-1">
                            <div>Versi: 1.0.0</div>
                            <div>Status: Siap digunakan</div>
                            <div>Mode: PWA (Progressive Web App)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Scan Section (Hidden by default) -->
        <div id="scanSection" class="max-w-2xl mx-auto hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">📷 Scan Absensi</h2>
                
                <!-- Quick Teacher Attendance -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h3 class="font-bold text-blue-800 mb-3">👨‍🏫 Absen Cepat Guru</h3>
                    <div class="space-y-3">
                        <input type="text" id="guruName" placeholder="Nama guru" 
                               class="w-full px-4 py-2 border border-blue-300 rounded-lg">
                        <input type="text" id="guruMapel" placeholder="Mata pelajaran" 
                               class="w-full px-4 py-2 border border-blue-300 rounded-lg">
                        <button id="quickAbsenGuru" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                            ⚡ Absen Cepat
                        </button>
                    </div>
                </div>
                
                <!-- Scanner Area -->
                <div class="relative bg-gray-100 rounded-lg p-6 mb-6 border-2 border-dashed border-gray-300">
                    <div class="text-center">
                        <div class="relative inline-block">
                            <div class="w-64 h-32 bg-white rounded-lg shadow-inner flex items-center justify-center relative overflow-hidden">
                                <div class="scanner-line absolute w-full h-1 bg-red-500 opacity-70"></div>
                                <span class="text-gray-500 text-sm">Arahkan barcode ke sini</span>
                            </div>
                        </div>
                        <p class="text-gray-600 mt-4">Atau masukkan kode manual:</p>
                        <div class="flex gap-2 mt-2 justify-center">
                            <input type="text" id="manualCode" placeholder="Masukkan kode barcode" 
                                   class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <button id="scanButton" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                Scan
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Scan Result -->
                <div id="scanResult" class="hidden">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <span class="text-2xl">✅</span>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-lg font-medium text-green-800">Absensi Berhasil!</h3>
                                <div id="attendanceInfo" class="text-green-700 mt-1"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Today's Status -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">📅 Absensi Hari Ini</h3>
                <div id="todayAttendance" class="space-y-3">
                    <div class="text-gray-500 text-center py-4">Belum ada absensi hari ini</div>
                </div>
            </div>
        </div>

        <!-- Generate Section -->
        <div id="generateSection" class="max-w-2xl mx-auto hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">🏷️ Buat Barcode Guru</h2>
                
                <form id="generateForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                        <input type="text" id="userName" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="Masukkan nama lengkap guru">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                        <input type="text" id="userSubject" required
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="Contoh: Matematika">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">NIP (Opsional)</label>
                        <input type="text" id="userNIP" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="Nomor Induk Pegawai">
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                        🏷️ Buat Barcode Guru
                    </button>
                </form>
                
                <!-- Generated Barcode -->
                <div id="generatedBarcode" class="hidden mt-8 text-center">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Barcode Guru Berhasil Dibuat!</h3>
                    <div class="bg-gray-50 rounded-lg p-6">
                        <canvas id="barcodeCanvas" class="mx-auto mb-4"></canvas>
                        <div id="barcodeInfo" class="text-sm text-gray-600 mb-4"></div>
                        <button id="downloadBarcode" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            💾 Download Barcode
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Section -->
        <div id="reportSection" class="max-w-4xl mx-auto hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">📊 Laporan Absensi</h2>
                
                <!-- Statistics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-blue-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-blue-600" id="totalToday">0</div>
                        <div class="text-blue-800 font-medium text-sm">Absen Hari Ini</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-purple-600" id="totalTeachers">0</div>
                        <div class="text-purple-800 font-medium text-sm">Total Guru</div>
                    </div>
                    <div class="bg-orange-50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-orange-600" id="totalRecords">0</div>
                        <div class="text-orange-800 font-medium text-sm">Total Rekaman</div>
                    </div>
                </div>
                
                <!-- Attendance Table -->
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-300 px-4 py-2 text-left">Waktu</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Nama Guru</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Mata Pelajaran</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Status</th>
                            </tr>
                        </thead>
                        <tbody id="reportTable">
                            <tr>
                                <td colspan="4" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                    Belum ada data absensi
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Admin Settings Section -->
        <div id="settingsSection" class="max-w-2xl mx-auto hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">⚙️ Pengaturan Admin</h2>
                
                <!-- Admin Profile -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h3 class="font-bold text-blue-800 mb-3">👤 Profil Admin</h3>
                    <div class="space-y-3">
                        <div class="text-sm text-blue-700">
                            <div><strong>Username:</strong> admin</div>
                            <div><strong>Status:</strong> <span class="text-green-600">✅ Aktif</span></div>
                            <div><strong>Login terakhir:</strong> <span id="lastLoginTime">-</span></div>
                        </div>
                    </div>
                </div>

                <!-- System Settings -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6">
                    <h3 class="font-bold text-gray-800 mb-3">🔧 Pengaturan Sistem</h3>
                    <div class="space-y-4">
                        <!-- Auto Logout -->
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-medium text-gray-700">Auto Logout</div>
                                <div class="text-sm text-gray-600">Logout otomatis setelah tidak aktif</div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoLogout" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>

                        <!-- Notification Sound -->
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-medium text-gray-700">Suara Notifikasi</div>
                                <div class="text-sm text-gray-600">Bunyi saat ada absensi baru</div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="notificationSound" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>

                        <!-- Working Hours -->
                        <div>
                            <div class="font-medium text-gray-700 mb-2">Jam Kerja</div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Jam Masuk</label>
                                    <input type="time" id="workStartTime" value="07:00" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Jam Pulang</label>
                                    <input type="time" id="workEndTime" value="16:00" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Share App Link -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                    <h3 class="font-bold text-purple-800 mb-3">📤 Bagikan Aplikasi</h3>
                    <div class="space-y-3">
                        <div class="bg-white p-3 rounded border text-sm">
                            <div class="font-medium text-gray-700 mb-2">Link Aplikasi:</div>
                            <div id="adminAppLink" class="text-blue-600 break-all text-xs bg-gray-50 p-2 rounded"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="adminCopyLink" class="bg-purple-500 text-white py-2 px-3 rounded-lg hover:bg-purple-600 transition-colors text-sm font-medium">
                                📋 Salin Link
                            </button>
                            <button id="adminShareLink" class="bg-green-500 text-white py-2 px-3 rounded-lg hover:bg-green-600 transition-colors text-sm font-medium">
                                📱 Bagikan
                            </button>
                        </div>
                        
                        <!-- QR Code for easy sharing -->
                        <div class="bg-white p-3 rounded border text-center">
                            <div class="font-medium text-gray-700 mb-2">QR Code untuk Install:</div>
                            <div id="qrCodeContainer" class="flex justify-center mb-2">
                                <canvas id="qrCodeCanvas" class="border border-gray-200 rounded"></canvas>
                            </div>
                            <div class="text-xs text-gray-600">Scan QR code ini dengan kamera HP untuk langsung buka aplikasi</div>
                        </div>
                        
                        <!-- Download as File -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3">
                            <div class="font-medium text-blue-800 mb-2">💾 Download Aplikasi</div>
                            <div class="space-y-2">
                                <button id="downloadApp" class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium">
                                    📱 Download File HTML
                                </button>
                                <button id="generateAPK" class="w-full bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors text-sm font-medium">
                                    📦 Generate APK Android
                                </button>
                            </div>
                            <div class="text-xs text-blue-700 mt-2">
                                • File HTML: Buka di browser HP, bisa install sebagai PWA<br>
                                • APK: Install langsung seperti aplikasi Android biasa
                            </div>
                        </div>
                        
                        <!-- Hosting Options -->
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                            <div class="font-medium text-purple-800 mb-2">🌐 Hosting Online</div>
                            <div class="space-y-2">
                                <button id="hostOnGitHub" class="w-full bg-gray-800 text-white py-2 px-4 rounded-lg hover:bg-gray-900 transition-colors text-sm font-medium">
                                    🐙 Host di GitHub Pages
                                </button>
                                <button id="hostOnNetlify" class="w-full bg-teal-500 text-white py-2 px-4 rounded-lg hover:bg-teal-600 transition-colors text-sm font-medium">
                                    🚀 Host di Netlify
                                </button>
                                <button id="generateHostingFiles" class="w-full bg-indigo-500 text-white py-2 px-4 rounded-lg hover:bg-indigo-600 transition-colors text-sm font-medium">
                                    📁 Download Paket Hosting
                                </button>
                            </div>
                            <div class="text-xs text-purple-700 mt-2">
                                Host online agar guru bisa akses via link tanpa download file
                            </div>
                        </div>
                        
                        <div class="text-xs text-purple-700 bg-purple-100 p-2 rounded">
                            💡 <strong>5 Cara Bagikan ke Guru:</strong><br>
                            1. <strong>WhatsApp:</strong> Klik "📱 Bagikan" untuk kirim link + instruksi lengkap<br>
                            2. <strong>QR Code:</strong> Tunjukkan QR Code untuk di-scan langsung<br>
                            3. <strong>File HTML:</strong> Download file aplikasi lalu kirim via WhatsApp/email/Bluetooth<br>
                            4. <strong>APK Android:</strong> Generate APK untuk install seperti aplikasi biasa<br>
                            5. <strong>Hosting Online:</strong> Upload ke internet agar bisa diakses via link
                        </div>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6">
                    <h3 class="font-bold text-orange-800 mb-3">📊 Manajemen Data</h3>
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <button id="exportData" class="bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors text-sm font-medium">
                                📤 Export Data
                            </button>
                            <button id="importData" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium">
                                📥 Import Data
                            </button>
                        </div>
                        <input type="file" id="importFile" accept=".json" class="hidden">
                        
                        <div class="bg-white p-3 rounded border text-sm">
                            <div class="font-medium text-gray-700 mb-2">📈 Statistik Data:</div>
                            <div class="space-y-1 text-gray-600">
                                <div>Total Absensi: <span id="totalAttendanceCount" class="font-medium">0</span></div>
                                <div>Total Guru: <span id="totalTeacherCount" class="font-medium">0</span></div>
                                <div>Data Tersimpan: <span id="dataStorageSize" class="font-medium">0 KB</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                    <h3 class="font-bold text-red-800 mb-3">🔒 Keamanan</h3>
                    <div class="space-y-3">
                        <button id="changePassword" class="w-full bg-yellow-500 text-white py-2 px-4 rounded-lg hover:bg-yellow-600 transition-colors text-sm font-medium">
                            🔑 Ubah Password Admin
                        </button>
                        
                        <button id="clearAllData" class="w-full bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors text-sm font-medium">
                            🗑️ Hapus Semua Data
                        </button>
                        
                        <button id="logoutAdmin" class="w-full bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors text-sm font-medium">
                            🚪 Logout Admin
                        </button>
                    </div>
                </div>

                <!-- App Information -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <h3 class="font-bold text-purple-800 mb-3">ℹ️ Informasi Aplikasi</h3>
                    <div class="text-sm text-purple-700 space-y-1">
                        <div>Versi: 1.0.0</div>
                        <div>Mode: PWA (Progressive Web App)</div>
                        <div>Status: Siap digunakan</div>
                        <div>Browser: <span id="browserInfo">-</span></div>
                        <div>Platform: <span id="platformInfo">-</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GitHub Hosting Modal -->
        <div id="githubHostingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-screen overflow-y-auto">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">🐙 Deploy ke GitHub Pages</h3>
                
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-sm">
                    <div class="font-medium text-blue-800 mb-2">📋 Yang Dibutuhkan:</div>
                    <div class="text-blue-700 space-y-1">
                        <div>1. Akun GitHub (gratis di github.com)</div>
                        <div>2. Personal Access Token GitHub</div>
                        <div>3. Koneksi internet</div>
                    </div>
                </div>
                
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4 text-sm">
                    <div class="font-medium text-yellow-800 mb-2">🔑 Cara Buat Token:</div>
                    <div class="text-yellow-700 space-y-1">
                        <div>1. Login GitHub → Settings → Developer settings</div>
                        <div>2. Personal access tokens → Tokens (classic)</div>
                        <div>3. Generate new token → Centang "repo"</div>
                        <div>4. Copy token yang dihasilkan</div>
                    </div>
                </div>
                
                <form id="githubHostingForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username GitHub</label>
                        <input type="text" id="githubUsername" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="username">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Repository</label>
                        <input type="text" id="repoName" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="absensi-mobile">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Personal Access Token</label>
                        <input type="password" id="githubToken" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="ghp_xxxxxxxxxxxx">
                        <div class="text-xs text-gray-500 mt-1">Token akan digunakan sekali dan tidak disimpan</div>
                    </div>
                    
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3 text-sm">
                        <div class="font-medium text-green-800 mb-2">✅ Setelah Deploy:</div>
                        <div class="text-green-700 space-y-1">
                            <div>• Aplikasi akan online di: username.github.io/repo-name</div>
                            <div>• Bisa diakses dari mana saja</div>
                            <div>• Gratis selamanya</div>
                            <div>• Auto-generate README.md</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button type="submit" id="deployToGitHub" class="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                            🚀 Deploy Sekarang
                        </button>
                        <button type="button" id="cancelGitHubHosting" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition-colors font-medium">
                            ❌ Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- GitHub Success Modal -->
        <div id="githubSuccessModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">🎉</div>
                    <h3 class="text-2xl font-bold text-green-800 mb-2">Deploy Berhasil!</h3>
                    <p class="text-green-600">Aplikasi sudah online dan siap digunakan</p>
                </div>
                
                <div class="space-y-4">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="font-medium text-green-800 mb-2">🌐 Link Aplikasi:</div>
                        <div class="bg-white p-2 rounded border text-sm">
                            <a id="deployedAppLink" href="#" target="_blank" rel="noopener noreferrer" 
                               class="text-blue-600 hover:text-blue-800 break-all" id="deployedAppUrl">
                                <span id="deployedAppUrl"></span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <div class="font-medium text-gray-800 mb-2">📁 Repository GitHub:</div>
                        <div class="bg-white p-2 rounded border text-sm">
                            <a id="repoLink" href="#" target="_blank" rel="noopener noreferrer" 
                               class="text-blue-600 hover:text-blue-800 break-all">
                                <span id="repoUrl"></span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <button id="copyDeployedUrl" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium">
                            📋 Salin Link
                        </button>
                        <button id="shareDeployedApp" class="bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors text-sm font-medium">
                            📱 Bagikan
                        </button>
                    </div>
                    
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 text-sm">
                        <div class="font-medium text-purple-800 mb-2">📲 Cara Bagikan ke Guru:</div>
                        <div class="text-purple-700 space-y-1">
                            <div>1. Klik "📱 Bagikan" untuk kirim via WhatsApp</div>
                            <div>2. Atau salin link dan kirim manual</div>
                            <div>3. Guru buka link → Install PWA di HP</div>
                            <div>4. Aplikasi siap digunakan offline!</div>
                        </div>
                    </div>
                    
                    <button id="closeGitHubSuccess" class="w-full bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition-colors font-medium">
                        ✅ Selesai
                    </button>
                </div>
            </div>
        </div>

        <!-- Change Password Modal -->
        <div id="changePasswordModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">🔑 Ubah Password</h3>
                <form id="changePasswordForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password Lama</label>
                        <input type="password" id="oldPassword" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="Masukkan password lama">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password Baru</label>
                        <input type="password" id="newPassword" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="Masukkan password baru">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password</label>
                        <input type="password" id="confirmPassword" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="Konfirmasi password baru">
                    </div>
                    <div class="flex gap-2">
                        <button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                            💾 Simpan
                        </button>
                        <button type="button" id="cancelChangePassword" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition-colors font-medium">
                            ❌ Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Admin Login Modal (Hidden) -->
        <div id="adminLoginModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">🔐 Admin Login</h3>
                <form id="adminLoginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="adminUsername" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="Masukkan username admin">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="adminPassword" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="Masukkan password">
                    </div>
                    <div class="flex gap-2">
                        <button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                            🔓 Login
                        </button>
                        <button type="button" id="cancelAdminLogin" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition-colors font-medium">
                            ❌ Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Admin Access Button - Always visible -->
        <div class="fixed bottom-4 right-4 z-50">
            <div class="flex flex-col gap-2 items-end">
                <!-- Admin Login Button (always visible) -->
                <button id="adminAccessButton" class="bg-gray-600 text-white px-4 py-2 rounded-full shadow-lg hover:bg-gray-700 transition-colors text-sm font-medium">
                    🔐 Admin
                </button>
                
                <!-- Mode Toggle (visible when authenticated) -->
                <button id="adminModeToggle" class="hidden bg-blue-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-blue-600 transition-colors text-sm font-medium">
                    <span id="modeToggleText">👨‍💼 Mode Admin</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords') || '[]');
        let teacherProfile = JSON.parse(localStorage.getItem('teacherProfile') || '{}');
        let currentMode = localStorage.getItem('userMode') || 'teacher';
        
        // Hidden admin access
        let keySequence = '';
        let adminAuthenticated = localStorage.getItem('adminAuth') === 'true';
        
        // Hidden admin keyboard listener
        document.addEventListener('keydown', function(e) {
            keySequence += e.key.toLowerCase();
            
            // Keep only last 5 characters
            if (keySequence.length > 5) {
                keySequence = keySequence.slice(-5);
            }
            
            // Check for "absen" sequence
            if (keySequence.includes('absen')) {
                keySequence = ''; // Reset
                showAdminLogin();
            }
        });
        
        // PWA Setup
        function setupPWA() {
            // Create manifest dynamically
            const manifest = {
                name: "Absensi Mobile - Guru",
                short_name: "Absensi Guru",
                description: "Aplikasi absensi mobile untuk guru",
                start_url: "./",
                display: "standalone",
                background_color: "#ffffff",
                theme_color: "#3B82F6",
                orientation: "portrait",
                scope: "./",
                icons: [
                    {
                        src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMzQjgyRjYiLz4KPHBhdGggZD0iTTQ4IDY0SDE0NFY4MEg0OFY2NFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik00OCA5NkgxNDRWMTEySDQ4Vjk2WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTQ4IDEyOEgxMTJWMTQ0SDQ4VjEyOFoiIGZpbGw9IndoaXRlIi8+CjxjaXJjbGUgY3g9IjE0NCIgY3k9IjEzNiIgcj0iMTYiIGZpbGw9IiMxMEI5ODEiLz4KPHBhdGggZD0iTTEzNiAxMzZMMTQwIDE0MEwxNTIgMTI4IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjMiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K",
                        sizes: "192x192",
                        type: "image/svg+xml",
                        purpose: "any maskable"
                    },
                    {
                        src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiByeD0iNjQiIGZpbGw9IiMzQjgyRjYiLz4KPHBhdGggZD0iTTEyOCAxNzBIMzg0VjIxNEgxMjhWMTcwWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTEyOCAyNTZIMzg0VjMwMEgxMjhWMjU2WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTEyOCAzNDJIMzAwVjM4NkgxMjhWMzQyWiIgZmlsbD0id2hpdGUiLz4KPGNpcmNsZSBjeD0iMzg0IiBjeT0iMzY0IiByPSI0MiIgZmlsbD0iIzEwQjk4MSIvPgo8cGF0aCBkPSJNMzYyIDM2NEwzNzQgMzc2TDQwNiAzNDQiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iOCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo=",
                        sizes: "512x512",
                        type: "image/svg+xml",
                        purpose: "any maskable"
                    }
                ]
            };
            
            // Create manifest blob and URL
            const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
            const manifestURL = URL.createObjectURL(manifestBlob);
            
            // Set manifest link
            document.getElementById('manifest-placeholder').href = manifestURL;
            
            // Register service worker
            if ('serviceWorker' in navigator) {
                // Create service worker content
                const swContent = `
                    const CACHE_NAME = 'absensi-mobile-v1';
                    const urlsToCache = [
                        './',
                        'https://cdn.tailwindcss.com',
                        'https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js'
                    ];

                    self.addEventListener('install', function(event) {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(function(cache) {
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });

                    self.addEventListener('fetch', function(event) {
                        event.respondWith(
                            caches.match(event.request)
                                .then(function(response) {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                }
                            )
                        );
                    });
                `;
                
                // Create service worker blob and register
                const swBlob = new Blob([swContent], { type: 'application/javascript' });
                const swURL = URL.createObjectURL(swBlob);
                
                navigator.serviceWorker.register(swURL)
                    .then(function(registration) {
                        console.log('Service Worker registered successfully');
                        updatePWAStatus('✅ Service Worker: Aktif');
                    })
                    .catch(function(error) {
                        console.log('Service Worker registration failed');
                        updatePWAStatus('❌ Service Worker: Error');
                    });
            }
        }

        // Update PWA status display
        function updatePWAStatus(message) {
            const featuresElement = document.getElementById('pwaFeatures');
            if (featuresElement) {
                featuresElement.innerHTML = `
                    ✅ Manifest file: Aktif<br>
                    ${message}<br>
                    ✅ Offline support: Aktif<br>
                    ✅ Install prompt: Siap
                `;
            }
        }
        
        // PWA Install
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.remove('hidden');
        });

        document.getElementById('installButton').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    document.getElementById('installPrompt').classList.add('hidden');
                }
                deferredPrompt = null;
            }
        });

        // Tab switching for teacher mode
        const teacherTabs = ['absenTab', 'historyTab', 'profileTab'];
        const teacherSections = ['absenSection', 'historySection', 'profileSection'];
        
        // Tab switching for admin mode
        const adminTabs = ['scanTab', 'generateTab', 'reportTab', 'settingsTab'];
        const adminSections = ['scanSection', 'generateSection', 'reportSection', 'settingsSection'];

        // Teacher tab switching
        teacherTabs.forEach((tabId, index) => {
            document.getElementById(tabId).addEventListener('click', () => {
                // Update tab styles
                teacherTabs.forEach(tab => {
                    const element = document.getElementById(tab);
                    element.classList.remove('bg-blue-500', 'text-white');
                    element.classList.add('text-gray-600');
                });
                document.getElementById(tabId).classList.add('bg-blue-500', 'text-white');
                document.getElementById(tabId).classList.remove('text-gray-600');

                // Show/hide sections
                teacherSections.forEach(section => {
                    document.getElementById(section).classList.add('hidden');
                });
                document.getElementById(teacherSections[index]).classList.remove('hidden');

                // Update data when switching tabs
                if (tabId === 'absenTab') {
                    updateTeacherDashboard();
                }
                if (tabId === 'historyTab') {
                    updateTeacherHistory();
                }
                if (tabId === 'profileTab') {
                    updateTeacherProfile();
                }
            });
        });

        // Admin tab switching
        adminTabs.forEach((tabId, index) => {
            document.getElementById(tabId).addEventListener('click', () => {
                // Update tab styles
                adminTabs.forEach(tab => {
                    const element = document.getElementById(tab);
                    element.classList.remove('bg-blue-500', 'text-white');
                    element.classList.add('text-gray-600');
                });
                document.getElementById(tabId).classList.add('bg-blue-500', 'text-white');
                document.getElementById(tabId).classList.remove('text-gray-600');

                // Show/hide sections
                adminSections.forEach(section => {
                    document.getElementById(section).classList.add('hidden');
                });
                document.getElementById(adminSections[index]).classList.remove('hidden');

                // Update data when switching tabs
                if (tabId === 'reportTab') {
                    updateReport();
                }
                if (tabId === 'scanTab') {
                    updateTodayAttendance();
                }
                if (tabId === 'settingsTab') {
                    updateSettings();
                }
            });
        });

        // Show admin login modal
        function showAdminLogin() {
            document.getElementById('adminLoginModal').classList.remove('hidden');
            document.getElementById('adminUsername').focus();
        }
        
        // Admin access button click
        document.getElementById('adminAccessButton').addEventListener('click', function() {
            showAdminLogin();
        });

        // Admin login form
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value;
            
            const currentPassword = localStorage.getItem('adminPassword') || 'Admin1234';
            
            if (username === 'admin' && password === currentPassword) {
                adminAuthenticated = true;
                localStorage.setItem('adminAuth', 'true');
                localStorage.setItem('lastAdminLogin', new Date().toISOString());
                
                // Hide modal
                document.getElementById('adminLoginModal').classList.add('hidden');
                
                // Update button visibility
                updateAdminButtonVisibility();
                
                // Clear form
                document.getElementById('adminUsername').value = '';
                document.getElementById('adminPassword').value = '';
                
                alert('✅ Login admin berhasil!');
                
            } else {
                alert('❌ Username atau password salah!');
                document.getElementById('adminPassword').value = '';
            }
        });
        
        // Update admin button visibility
        function updateAdminButtonVisibility() {
            const accessButton = document.getElementById('adminAccessButton');
            const modeToggle = document.getElementById('adminModeToggle');
            
            if (adminAuthenticated) {
                accessButton.classList.add('hidden');
                modeToggle.classList.remove('hidden');
            } else {
                accessButton.classList.remove('hidden');
                modeToggle.classList.add('hidden');
            }
        }

        // Cancel admin login
        document.getElementById('cancelAdminLogin').addEventListener('click', function() {
            document.getElementById('adminLoginModal').classList.add('hidden');
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
        });

        // Mode switching
        document.getElementById('adminModeToggle').addEventListener('click', function() {
            if (currentMode === 'teacher') {
                currentMode = 'admin';
                localStorage.setItem('userMode', currentMode);
                updateUIForMode();
            } else {
                currentMode = 'teacher';
                localStorage.setItem('userMode', currentMode);
                updateUIForMode();
            }
        });

        // Update UI based on user mode
        function updateUIForMode() {
            const mainTabs = document.getElementById('mainTabs');
            const adminTabs = document.getElementById('adminTabs');
            const modeToggleText = document.getElementById('modeToggleText');
            
            if (currentMode === 'teacher') {
                mainTabs.classList.remove('hidden');
                adminTabs.classList.add('hidden');
                modeToggleText.textContent = '👨‍💼 Mode Admin';
                
                // Show teacher sections, hide admin sections
                teacherSections.forEach(section => {
                    if (section === 'absenSection') {
                        document.getElementById(section).classList.remove('hidden');
                    } else {
                        document.getElementById(section).classList.add('hidden');
                    }
                });
                adminSections.forEach(section => {
                    document.getElementById(section).classList.add('hidden');
                });
                
                updateTeacherDashboard();
            } else {
                mainTabs.classList.add('hidden');
                adminTabs.classList.remove('hidden');
                modeToggleText.textContent = '👨‍🏫 Mode Guru';
                
                // Show admin sections, hide teacher sections
                teacherSections.forEach(section => {
                    document.getElementById(section).classList.add('hidden');
                });
                adminSections.forEach(section => {
                    if (section === 'scanSection') {
                        document.getElementById(section).classList.remove('hidden');
                    } else {
                        document.getElementById(section).classList.add('hidden');
                    }
                });
                
                updateTodayAttendance();
            }
        }

        // Teacher profile management
        document.getElementById('saveTeacherProfile').addEventListener('click', function() {
            const name = document.getElementById('teacherName').value.trim();
            const subject = document.getElementById('teacherSubject').value.trim();
            const nip = document.getElementById('teacherNIP').value.trim();
            
            if (!name || !subject) {
                alert('Nama dan mata pelajaran wajib diisi!');
                return;
            }
            
            teacherProfile = {
                name: name,
                subject: subject,
                nip: nip,
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('teacherProfile', JSON.stringify(teacherProfile));
            updateTeacherDashboard();
            alert('Profil berhasil disimpan!');
        });

        // Update teacher profile
        document.getElementById('updateProfile').addEventListener('click', function() {
            const name = document.getElementById('editTeacherName').value.trim();
            const subject = document.getElementById('editTeacherSubject').value.trim();
            const nip = document.getElementById('editTeacherNIP').value.trim();
            
            if (!name || !subject) {
                alert('Nama dan mata pelajaran wajib diisi!');
                return;
            }
            
            teacherProfile.name = name;
            teacherProfile.subject = subject;
            teacherProfile.nip = nip;
            
            localStorage.setItem('teacherProfile', JSON.stringify(teacherProfile));
            updateTeacherProfile();
            alert('Profil berhasil diupdate!');
        });

        // Teacher attendance buttons
        document.getElementById('absenMasuk').addEventListener('click', async function() {
            await performTeacherAttendance('masuk', this);
        });

        document.getElementById('absenPulang').addEventListener('click', async function() {
            await performTeacherAttendance('pulang', this);
        });

        // Perform teacher attendance
        async function performTeacherAttendance(type, button) {
            if (!teacherProfile.name) {
                alert('Lengkapi profil terlebih dahulu!');
                return;
            }

            // Show loading
            const originalText = button.textContent;
            button.textContent = 'Memproses...';
            button.disabled = true;

            try {
                // Check if already attended today for this type
                const today = new Date().toDateString();
                const existingRecord = attendanceRecords.find(r => 
                    r.userName === teacherProfile.name && 
                    new Date(r.timestamp).toDateString() === today &&
                    r.attendanceType === type
                );

                if (existingRecord) {
                    throw new Error(`Anda sudah absen ${type} hari ini!`);
                }

                // Create attendance record
                const now = new Date();
                const record = {
                    id: 'ATT_' + Date.now(),
                    userId: 'TEACHER_' + teacherProfile.name.replace(/\s+/g, '_'),
                    userName: teacherProfile.name,
                    userType: 'guru',
                    userSubject: teacherProfile.subject,
                    timestamp: now.toISOString(),
                    status: 'Hadir',
                    attendanceType: type,
                    device: 'teacher_mobile'
                };

                attendanceRecords.push(record);
                localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));

                // Show success
                alert(`✅ Absen ${type} berhasil!\nWaktu: ${now.toLocaleTimeString('id-ID')}`);
                
                // Update display
                updateTeacherDashboard();

            } catch (error) {
                alert(error.message);
            } finally {
                // Reset button
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        // Update teacher dashboard
        function updateTeacherDashboard() {
            const teacherSetup = document.getElementById('teacherSetup');
            const quickAttendance = document.getElementById('quickAttendance');
            
            if (!teacherProfile.name) {
                teacherSetup.classList.remove('hidden');
                quickAttendance.classList.add('hidden');
                return;
            }
            
            teacherSetup.classList.add('hidden');
            quickAttendance.classList.remove('hidden');
            
            // Update welcome message
            document.getElementById('welcomeMessage').textContent = `Halo, ${teacherProfile.name}!`;
            document.getElementById('teacherInfo').textContent = `Guru ${teacherProfile.subject}`;
            
            // Update current time
            updateCurrentTime();
            
            // Update today's status
            updateTodayTeacherStatus();
        }

        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID');
            const dateString = now.toLocaleDateString('id-ID', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            document.getElementById('currentTime').innerHTML = `
                <div>${timeString}</div>
                <div class="text-xs">${dateString}</div>
            `;
        }

        // Update today's teacher status
        function updateTodayTeacherStatus() {
            if (!teacherProfile.name) return;
            
            const today = new Date().toDateString();
            const todayRecords = attendanceRecords.filter(r => 
                r.userName === teacherProfile.name && 
                new Date(r.timestamp).toDateString() === today
            );
            
            const container = document.getElementById('todayStatus');
            
            if (todayRecords.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-4">Belum ada absensi hari ini</div>';
                return;
            }
            
            container.innerHTML = todayRecords.map(record => {
                const time = new Date(record.timestamp).toLocaleTimeString('id-ID');
                const typeText = record.attendanceType === 'masuk' ? '🌅 Masuk' : '🌆 Pulang';
                
                return `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-medium text-green-800">${typeText}</div>
                                <div class="text-sm text-green-600">${time}</div>
                            </div>
                            <div class="text-green-600">✅</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update teacher history
        function updateTeacherHistory() {
            if (!teacherProfile.name) return;
            
            const teacherRecords = attendanceRecords.filter(r => r.userName === teacherProfile.name);
            
            // Update statistics
            const totalHadir = new Set(teacherRecords.map(r => new Date(r.timestamp).toDateString())).size;
            const totalTerlambat = teacherRecords.filter(r => r.status === 'Terlambat').length;
            
            document.getElementById('totalHadir').textContent = totalHadir;
            document.getElementById('totalTerlambat').textContent = totalTerlambat;
            
            // Update history list
            const container = document.getElementById('historyList');
            
            if (teacherRecords.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-4">Belum ada riwayat absensi</div>';
                return;
            }
            
            // Group by date
            const groupedRecords = {};
            teacherRecords.forEach(record => {
                const date = new Date(record.timestamp).toDateString();
                if (!groupedRecords[date]) {
                    groupedRecords[date] = [];
                }
                groupedRecords[date].push(record);
            });
            
            container.innerHTML = Object.keys(groupedRecords)
                .sort((a, b) => new Date(b) - new Date(a))
                .slice(0, 10) // Show last 10 days
                .map(date => {
                    const records = groupedRecords[date];
                    const dateStr = new Date(date).toLocaleDateString('id-ID', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                    
                    return `
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="font-medium text-gray-800 mb-2">${dateStr}</div>
                            <div class="space-y-2">
                                ${records.map(record => {
                                    const time = new Date(record.timestamp).toLocaleTimeString('id-ID');
                                    const typeText = record.attendanceType === 'masuk' ? '🌅 Masuk' : '🌆 Pulang';
                                    
                                    return `
                                        <div class="flex justify-between items-center text-sm">
                                            <span>${typeText} - ${time}</span>
                                            <span class="text-green-600">✅ ${record.status}</span>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
        }

        // Update teacher profile display
        function updateTeacherProfile() {
            const container = document.getElementById('profileInfo');
            
            if (!teacherProfile.name) {
                container.innerHTML = '<div class="text-gray-500">Belum ada profil tersimpan</div>';
                return;
            }
            
            container.innerHTML = `
                <div><strong>Nama:</strong> ${teacherProfile.name}</div>
                <div><strong>Mata Pelajaran:</strong> ${teacherProfile.subject}</div>
                ${teacherProfile.nip ? `<div><strong>NIP:</strong> ${teacherProfile.nip}</div>` : ''}
                <div><strong>Terdaftar:</strong> ${new Date(teacherProfile.createdAt).toLocaleDateString('id-ID')}</div>
            `;
            
            // Fill edit form
            document.getElementById('editTeacherName').value = teacherProfile.name || '';
            document.getElementById('editTeacherSubject').value = teacherProfile.subject || '';
            document.getElementById('editTeacherNIP').value = teacherProfile.nip || '';
            
            // Update app link
            updateAppLink();
        }

        // Update app link for sharing
        function updateAppLink() {
            const appLinkElement = document.getElementById('appLink');
            const currentUrl = window.location.href;
            appLinkElement.textContent = currentUrl;
        }

        // Copy link to clipboard
        document.getElementById('copyLink').addEventListener('click', async function() {
            const appLink = document.getElementById('appLink').textContent;
            
            try {
                await navigator.clipboard.writeText(appLink);
                
                // Show success feedback
                const button = this;
                const originalText = button.textContent;
                button.textContent = '✅ Tersalin!';
                button.classList.remove('bg-purple-500', 'hover:bg-purple-600');
                button.classList.add('bg-green-500');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-green-500');
                    button.classList.add('bg-purple-500', 'hover:bg-purple-600');
                }, 2000);
                
            } catch (error) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = appLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                alert('Link berhasil disalin ke clipboard!');
            }
        });

        // Share link using Web Share API or fallback
        document.getElementById('shareLink').addEventListener('click', async function() {
            const appLink = document.getElementById('appLink').textContent;
            const shareData = {
                title: 'Aplikasi Absensi Mobile',
                text: 'Gunakan aplikasi absensi mobile ini untuk absen dengan mudah di HP Anda!',
                url: appLink
            };
            
            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                } else {
                    // Fallback: create WhatsApp share link
                    const message = encodeURIComponent(`📱 *Aplikasi Absensi Mobile*\n\nGunakan aplikasi ini untuk absen dengan mudah di HP Anda!\n\n🔗 Link: ${appLink}\n\n📲 Cara install:\n1. Buka link di browser HP\n2. Tap menu (⋮) > "Tambahkan ke layar utama"\n3. Aplikasi siap digunakan!`);
                    const whatsappUrl = `https://wa.me/?text=${message}`;
                    window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
                }
            } catch (error) {
                // Final fallback: copy to clipboard
                try {
                    await navigator.clipboard.writeText(`📱 Aplikasi Absensi Mobile\n\nGunakan aplikasi ini untuk absen dengan mudah!\n\nLink: ${appLink}`);
                    alert('Link dan pesan berhasil disalin! Paste di aplikasi chat untuk membagikan.');
                } catch (clipboardError) {
                    alert(`Bagikan link ini ke guru:\n\n${appLink}`);
                }
            }
        });

        // Admin functions
        document.getElementById('quickAbsenGuru').addEventListener('click', function() {
            const name = document.getElementById('guruName').value.trim();
            const mapel = document.getElementById('guruMapel').value.trim();
            
            if (!name || !mapel) {
                alert('Nama guru dan mata pelajaran wajib diisi!');
                return;
            }
            
            // Create attendance record
            const now = new Date();
            const record = {
                id: 'ATT_' + Date.now(),
                userId: 'TEACHER_' + name.replace(/\s+/g, '_'),
                userName: name,
                userType: 'guru',
                userSubject: mapel,
                timestamp: now.toISOString(),
                status: 'Hadir',
                attendanceType: 'masuk',
                device: 'admin_scan'
            };

            attendanceRecords.push(record);
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
            
            alert(`✅ Absen berhasil untuk ${name}!`);
            
            // Clear form
            document.getElementById('guruName').value = '';
            document.getElementById('guruMapel').value = '';
            
            updateTodayAttendance();
        });

        // Barcode scanning
        document.getElementById('scanButton').addEventListener('click', function() {
            const code = document.getElementById('manualCode').value.trim();
            
            if (!code) {
                alert('Masukkan kode barcode!');
                return;
            }
            
            processBarcode(code);
        });

        function processBarcode(code) {
            try {
                // Try to parse barcode data
                let userData;
                
                if (code.startsWith('TEACHER_')) {
                    // Simple format: TEACHER_Name_Subject
                    const parts = code.split('_');
                    if (parts.length >= 3) {
                        userData = {
                            name: parts.slice(1, -1).join(' '),
                            subject: parts[parts.length - 1]
                        };
                    }
                } else {
                    // Try JSON format
                    userData = JSON.parse(code);
                }
                
                if (!userData || !userData.name || !userData.subject) {
                    throw new Error('Format barcode tidak valid');
                }
                
                // Create attendance record
                const now = new Date();
                const record = {
                    id: 'ATT_' + Date.now(),
                    userId: 'TEACHER_' + userData.name.replace(/\s+/g, '_'),
                    userName: userData.name,
                    userType: 'guru',
                    userSubject: userData.subject,
                    timestamp: now.toISOString(),
                    status: 'Hadir',
                    attendanceType: 'masuk',
                    device: 'barcode_scan'
                };

                attendanceRecords.push(record);
                localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
                
                // Show result
                document.getElementById('attendanceInfo').innerHTML = `
                    <div><strong>Nama:</strong> ${userData.name}</div>
                    <div><strong>Mata Pelajaran:</strong> ${userData.subject}</div>
                    <div><strong>Waktu:</strong> ${now.toLocaleTimeString('id-ID')}</div>
                `;
                document.getElementById('scanResult').classList.remove('hidden');
                
                // Clear input
                document.getElementById('manualCode').value = '';
                
                updateTodayAttendance();
                
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Generate barcode
        document.getElementById('generateForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('userName').value.trim();
            const subject = document.getElementById('userSubject').value.trim();
            const nip = document.getElementById('userNIP').value.trim();
            
            if (!name || !subject) {
                alert('Nama dan mata pelajaran wajib diisi!');
                return;
            }
            
            // Create barcode data
            const barcodeData = JSON.stringify({
                name: name,
                subject: subject,
                nip: nip,
                type: 'teacher',
                generated: new Date().toISOString()
            });
            
            // Generate barcode
            const canvas = document.getElementById('barcodeCanvas');
            JsBarcode(canvas, barcodeData, {
                format: "CODE128",
                width: 2,
                height: 100,
                displayValue: false
            });
            
            // Show info
            document.getElementById('barcodeInfo').innerHTML = `
                <div><strong>Nama:</strong> ${name}</div>
                <div><strong>Mata Pelajaran:</strong> ${subject}</div>
                ${nip ? `<div><strong>NIP:</strong> ${nip}</div>` : ''}
                <div class="text-xs text-gray-500 mt-2">Barcode ini dapat digunakan untuk absensi</div>
            `;
            
            document.getElementById('generatedBarcode').classList.remove('hidden');
        });

        // Download barcode
        document.getElementById('downloadBarcode').addEventListener('click', function() {
            const canvas = document.getElementById('barcodeCanvas');
            const link = document.createElement('a');
            link.download = 'barcode-guru.png';
            link.href = canvas.toDataURL();
            link.click();
        });

        // Download app as HTML file
        document.getElementById('downloadApp').addEventListener('click', function() {
            // Get current HTML content
            const htmlContent = document.documentElement.outerHTML;
            
            // Create blob with HTML content
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            
            // Create download link
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'absensi-mobile.html';
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Clean up
            URL.revokeObjectURL(url);
            
            // Show success message
            alert('✅ File aplikasi berhasil di-download!\n\n📱 Cara bagikan ke guru:\n1. Kirim file "absensi-mobile.html" via WhatsApp/email\n2. Guru buka file di browser HP\n3. Guru bisa install ke layar utama HP');
        });

        // Generate APK for Android
        document.getElementById('generateAPK').addEventListener('click', function() {
            // Show loading
            const button = this;
            const originalText = button.textContent;
            button.textContent = '⏳ Generating APK...';
            button.disabled = true;
            
            setTimeout(() => {
                try {
                    // Create APK-like package with PWA configuration
                    const apkData = generateAPKPackage();
                    
                    // Create download
                    const blob = new Blob([apkData], { type: 'application/zip' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = 'absensi-mobile-android.zip';
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    URL.revokeObjectURL(url);
                    
                    // Show instructions
                    showAPKInstructions();
                    
                } catch (error) {
                    alert('❌ Gagal generate APK: ' + error.message);
                } finally {
                    button.textContent = originalText;
                    button.disabled = false;
                }
            }, 2000);
        });

        // Generate APK package
        function generateAPKPackage() {
            const htmlContent = document.documentElement.outerHTML;
            
            // Create Android WebView wrapper
            const androidManifest = `<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.absensi.mobile"
    android:versionCode="1"
    android:versionName="1.0">
    
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    <uses-permission android:name="android.permission.CAMERA" />
    
    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="Absensi Mobile"
        android:theme="@style/AppTheme">
        
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:screenOrientation="portrait">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>
</manifest>`;

            const mainActivity = `package com.absensi.mobile;

import android.app.Activity;
import android.os.Bundle;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import android.webkit.WebSettings;

public class MainActivity extends Activity {
    private WebView webView;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        
        webView = new WebView(this);
        setContentView(webView);
        
        WebSettings webSettings = webView.getSettings();
        webSettings.setJavaScriptEnabled(true);
        webSettings.setDomStorageEnabled(true);
        webSettings.setAllowFileAccess(true);
        
        webView.setWebViewClient(new WebViewClient());
        webView.loadUrl("file:///android_asset/index.html");
    }
    
    @Override
    public void onBackPressed() {
        if (webView.canGoBack()) {
            webView.goBack();
        } else {
            super.onBackPressed();
        }
    }
}`;

            // Create package structure info
            const packageInfo = `# Absensi Mobile Android Package

## Cara Install:

### Opsi 1: Menggunakan Android Studio
1. Extract file ZIP ini
2. Buka Android Studio
3. Import project ini
4. Build APK (Build > Build Bundle(s)/APK(s) > Build APK(s))
5. Install APK ke HP Android

### Opsi 2: Menggunakan Online APK Builder
1. Upload file ZIP ini ke:
   - ApkOnline.com
   - Appy Pie App Builder
   - BuildFire
2. Generate APK
3. Download dan install

### Opsi 3: PWA (Recommended)
1. Buka file index.html di browser HP
2. Tap menu > "Tambahkan ke layar utama"
3. Aplikasi akan terinstall seperti APK

## File Structure:
- AndroidManifest.xml: Konfigurasi aplikasi Android
- MainActivity.java: Activity utama untuk WebView
- assets/index.html: File aplikasi web
- README.txt: Instruksi ini

## Note:
Aplikasi ini menggunakan WebView untuk menjalankan PWA.
Semua fitur web akan berfungsi normal di Android.
`;

            // Combine all files into a package description
            return `ABSENSI MOBILE ANDROID PACKAGE
================================

${packageInfo}

=== AndroidManifest.xml ===
${androidManifest}

=== MainActivity.java ===
${mainActivity}

=== assets/index.html ===
${htmlContent}

=== END OF PACKAGE ===`;
        }

        // Show APK instructions
        function showAPKInstructions() {
            const instructions = `📦 APK Package berhasil di-generate!

🎯 CARA INSTALL:

📱 OPSI 1 - PWA (TERMUDAH):
1. Buka file "absensi-mobile.html" di browser HP
2. Tap menu (⋮) > "Tambahkan ke layar utama"
3. Aplikasi langsung terinstall seperti APK!

🔧 OPSI 2 - Build APK:
1. Extract file ZIP yang di-download
2. Upload ke online APK builder:
   • ApkOnline.com
   • Appy Pie
   • BuildFire
3. Generate APK dan install

💻 OPSI 3 - Android Studio:
1. Import project ke Android Studio
2. Build APK
3. Install ke HP

✅ REKOMENDASI: Gunakan OPSI 1 (PWA) karena paling mudah dan cepat!`;

            alert(instructions);
        }

        // Host on GitHub Pages
        document.getElementById('hostOnGitHub').addEventListener('click', function() {
            showGitHubHostingModal();
        });

        // Show GitHub hosting modal
        function showGitHubHostingModal() {
            const modal = document.getElementById('githubHostingModal');
            modal.classList.remove('hidden');
            
            // Pre-fill repository name
            document.getElementById('repoName').value = 'absensi-mobile-' + Date.now();
        }

        // GitHub hosting form
        document.getElementById('githubHostingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('githubUsername').value.trim();
            const repoName = document.getElementById('repoName').value.trim();
            const token = document.getElementById('githubToken').value.trim();
            
            if (!username || !repoName || !token) {
                alert('❌ Semua field wajib diisi!');
                return;
            }
            
            deployToGitHub(username, repoName, token);
        });

        // Deploy to GitHub
        async function deployToGitHub(username, repoName, token) {
            const button = document.getElementById('deployToGitHub');
            const originalText = button.textContent;
            button.textContent = '🚀 Deploying...';
            button.disabled = true;
            
            try {
                // Step 1: Create repository
                await createGitHubRepository(username, repoName, token);
                
                // Step 2: Upload files
                await uploadFilesToGitHub(username, repoName, token);
                
                // Step 3: Enable GitHub Pages
                await enableGitHubPages(username, repoName, token);
                
                // Success
                const appUrl = `https://${username}.github.io/${repoName}`;
                
                document.getElementById('githubHostingModal').classList.add('hidden');
                document.getElementById('githubHostingForm').reset();
                
                showGitHubSuccess(appUrl, username, repoName);
                
            } catch (error) {
                console.error('GitHub deployment error:', error);
                alert('❌ Gagal deploy ke GitHub: ' + error.message);
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        // Create GitHub repository
        async function createGitHubRepository(username, repoName, token) {
            const response = await fetch('https://api.github.com/user/repos', {
                method: 'POST',
                headers: {
                    'Authorization': `token ${token}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    name: repoName,
                    description: 'Aplikasi Absensi Mobile - PWA untuk Guru',
                    public: true,
                    auto_init: true
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'Gagal membuat repository');
            }
            
            return response.json();
        }

        // Upload files to GitHub
        async function uploadFilesToGitHub(username, repoName, token) {
            const htmlContent = document.documentElement.outerHTML;
            
            // Upload index.html
            await uploadFileToGitHub(username, repoName, token, 'index.html', htmlContent);
            
            // Upload README.md
            const readmeContent = generateReadmeContent();
            await uploadFileToGitHub(username, repoName, token, 'README.md', readmeContent);
        }

        // Upload single file to GitHub
        async function uploadFileToGitHub(username, repoName, token, filename, content) {
            const encodedContent = btoa(unescape(encodeURIComponent(content)));
            
            const response = await fetch(`https://api.github.com/repos/${username}/${repoName}/contents/${filename}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${token}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    message: `Add ${filename}`,
                    content: encodedContent
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`Gagal upload ${filename}: ${error.message}`);
            }
            
            return response.json();
        }

        // Enable GitHub Pages
        async function enableGitHubPages(username, repoName, token) {
            const response = await fetch(`https://api.github.com/repos/${username}/${repoName}/pages`, {
                method: 'POST',
                headers: {
                    'Authorization': `token ${token}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    source: {
                        branch: 'main',
                        path: '/'
                    }
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                // GitHub Pages might already be enabled, so we ignore this error
                console.warn('GitHub Pages setup warning:', error.message);
            }
            
            return response.ok ? response.json() : null;
        }

        // Generate README content
        function generateReadmeContent() {
            return `# 📱 Aplikasi Absensi Mobile

Aplikasi Progressive Web App (PWA) untuk absensi guru yang dapat diinstall di smartphone.

## 🚀 Akses Aplikasi

**Link Aplikasi:** [Buka Aplikasi](https://username.github.io/repo-name)

## 📲 Cara Install di HP

### Android (Chrome/Edge):
1. Buka link aplikasi di browser HP
2. Tap menu (⋮) di pojok kanan atas
3. Pilih "Tambahkan ke layar utama"
4. Tap "Tambah" untuk konfirmasi

### iPhone (Safari):
1. Buka link aplikasi di Safari
2. Tap tombol bagikan (📤) di bawah
3. Scroll dan pilih "Tambah ke Layar Utama"
4. Tap "Tambah" untuk konfirmasi

## ✨ Fitur

- 📱 **PWA (Progressive Web App)** - Install seperti aplikasi native
- 🔄 **Offline Support** - Bisa digunakan tanpa internet setelah pertama kali dibuka
- 👨‍🏫 **Mode Guru** - Absen masuk/pulang dengan mudah
- 👨‍💼 **Mode Admin** - Kelola absensi dan generate barcode
- 📊 **Laporan** - Lihat statistik dan riwayat absensi
- 🏷️ **Barcode Generator** - Buat barcode untuk guru
- 📤 **Export/Import** - Backup dan restore data

## 🔐 Admin Access

- Username: \`admin\`
- Password: \`Admin1234\`
- Atau ketik "absen" di keyboard untuk akses cepat

## 🛠️ Teknologi

- HTML5, CSS3, JavaScript
- Tailwind CSS
- PWA (Service Worker + Manifest)
- Local Storage untuk data
- JsBarcode untuk generate barcode
- QR Code generator

## 📝 Lisensi

MIT License - Bebas digunakan untuk keperluan pendidikan.

---

Dibuat dengan ❤️ untuk memudahkan absensi guru di sekolah.`;
        }

        // Show GitHub success modal
        function showGitHubSuccess(appUrl, username, repoName) {
            const successModal = document.getElementById('githubSuccessModal');
            document.getElementById('deployedAppUrl').textContent = appUrl;
            document.getElementById('deployedAppLink').href = appUrl;
            document.getElementById('repoUrl').textContent = `https://github.com/${username}/${repoName}`;
            document.getElementById('repoLink').href = `https://github.com/${username}/${repoName}`;
            
            successModal.classList.remove('hidden');
        }

        // Copy deployed URL
        document.getElementById('copyDeployedUrl').addEventListener('click', async function() {
            const url = document.getElementById('deployedAppUrl').textContent;
            
            try {
                await navigator.clipboard.writeText(url);
                
                const button = this;
                const originalText = button.textContent;
                button.textContent = '✅ Tersalin!';
                button.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                button.classList.add('bg-green-500');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-green-500');
                    button.classList.add('bg-blue-500', 'hover:bg-blue-600');
                }, 2000);
                
            } catch (error) {
                alert('Link berhasil disalin: ' + url);
            }
        });

        // Share deployed app
        document.getElementById('shareDeployedApp').addEventListener('click', async function() {
            const url = document.getElementById('deployedAppUrl').textContent;
            const shareData = {
                title: 'Aplikasi Absensi Mobile - Sudah Online!',
                text: '📱 Aplikasi absensi mobile sudah online dan siap digunakan!',
                url: url
            };
            
            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                } else {
                    const message = encodeURIComponent(`📱 *Aplikasi Absensi Mobile - SUDAH ONLINE!*\n\n✅ Aplikasi sudah berhasil di-deploy ke GitHub Pages dan siap digunakan!\n\n🔗 *Link Aplikasi:* ${url}\n\n📲 *Cara Install di HP:*\n\n*Android (Chrome/Edge):*\n1. Buka link di browser HP\n2. Tap menu (⋮) di pojok kanan atas\n3. Pilih "Tambahkan ke layar utama"\n4. Tap "Tambah" untuk konfirmasi\n\n*iPhone (Safari):*\n1. Buka link di Safari\n2. Tap tombol bagikan (📤) di bawah\n3. Scroll dan pilih "Tambah ke Layar Utama"\n4. Tap "Tambah" untuk konfirmasi\n\n✨ Setelah install, aplikasi akan muncul di layar utama HP seperti aplikasi lainnya!\n\n🔐 *Admin Access:*\n- Username: admin\n- Password: Admin1234`);
                    const whatsappUrl = `https://wa.me/?text=${message}`;
                    window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
                }
            } catch (error) {
                alert(`Bagikan link ini:\n\n${url}`);
            }
        });

        // Close modals
        document.getElementById('cancelGitHubHosting').addEventListener('click', function() {
            document.getElementById('githubHostingModal').classList.add('hidden');
            document.getElementById('githubHostingForm').reset();
        });

        document.getElementById('closeGitHubSuccess').addEventListener('click', function() {
            document.getElementById('githubSuccessModal').classList.add('hidden');
        });

        // Host on Netlify
        document.getElementById('hostOnNetlify').addEventListener('click', function() {
            const instructions = `🚀 HOST DI NETLIFY

📋 LANGKAH-LANGKAH:

1️⃣ Persiapan:
   • Download file HTML aplikasi
   • Rename jadi "index.html"

2️⃣ Deploy ke Netlify:
   • Buka netlify.com
   • Klik "Deploy to Netlify"
   • Drag & drop file "index.html"
   • Tunggu proses upload

3️⃣ Dapatkan Link:
   • Netlify akan generate link otomatis
   • Contoh: https://amazing-app-123.netlify.app
   • Link langsung bisa digunakan!

4️⃣ Custom Domain (Opsional):
   • Bisa ganti dengan domain sendiri
   • Atau gunakan subdomain Netlify

✅ SUPER MUDAH - Drag & drop langsung online!`;

            alert(instructions);
            
            // Open Netlify in new tab
            window.open('https://app.netlify.com/drop', '_blank', 'noopener,noreferrer');
        });

        // Generate hosting package
        document.getElementById('generateHostingFiles').addEventListener('click', function() {
            const button = this;
            const originalText = button.textContent;
            button.textContent = '📦 Generating...';
            button.disabled = true;
            
            setTimeout(() => {
                try {
                    const hostingPackage = generateHostingPackage();
                    
                    const blob = new Blob([hostingPackage], { type: 'application/zip' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = 'absensi-mobile-hosting.zip';
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    URL.revokeObjectURL(url);
                    
                    showHostingInstructions();
                    
                } catch (error) {
                    alert('❌ Gagal generate paket hosting: ' + error.message);
                } finally {
                    button.textContent = originalText;
                    button.disabled = false;
                }
            }, 1500);
        });

        // Generate hosting package
        function generateHostingPackage() {
            const htmlContent = document.documentElement.outerHTML;
            
            const netlifyConfig = `# Netlify Configuration
[build]
  publish = "."

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"

[[headers]]
  for = "/manifest.json"
  [headers.values]
    Content-Type = "application/json"`;

            const vercelConfig = `{
  "version": 2,
  "name": "absensi-mobile",
  "builds": [
    {
      "src": "index.html",
      "use": "@vercel/static"
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}`;

            const readmeHosting = `# Absensi Mobile - Hosting Package

## Cara Deploy:

### 1. Netlify (Termudah)
1. Buka netlify.com
2. Drag & drop file index.html
3. Aplikasi langsung online!

### 2. Vercel
1. Buka vercel.com
2. Import project atau drag & drop
3. Deploy otomatis

### 3. GitHub Pages
1. Upload index.html ke repository GitHub
2. Aktifkan Pages di Settings
3. Akses via username.github.io/repo-name

### 4. Firebase Hosting
1. Install Firebase CLI
2. firebase init hosting
3. firebase deploy

### 5. Surge.sh
1. npm install -g surge
2. surge (di folder ini)
3. Ikuti instruksi

## File yang Disertakan:
- index.html: Aplikasi utama
- netlify.toml: Konfigurasi Netlify
- vercel.json: Konfigurasi Vercel
- README.md: Instruksi ini

## Setelah Deploy:
1. Dapatkan URL aplikasi
2. Bagikan URL ke guru
3. Guru bisa langsung akses dan install PWA

## Tips:
- Gunakan Netlify untuk kemudahan
- URL akan seperti: https://app-name.netlify.app
- Aplikasi bisa diakses offline setelah pertama kali dibuka
`;

            return `ABSENSI MOBILE HOSTING PACKAGE
===============================

${readmeHosting}

=== index.html ===
${htmlContent}

=== netlify.toml ===
${netlifyConfig}

=== vercel.json ===
${vercelConfig}

=== END OF PACKAGE ===`;
        }

        // Show hosting instructions
        function showHostingInstructions() {
            const instructions = `📁 Paket Hosting berhasil di-generate!

🌐 CARA DEPLOY:

🚀 NETLIFY (TERMUDAH):
1. Buka netlify.com
2. Drag & drop file "index.html" 
3. Aplikasi langsung online!
4. Dapatkan link seperti: amazing-app.netlify.app

⚡ VERCEL:
1. Buka vercel.com
2. Import project atau drag & drop
3. Deploy otomatis

🐙 GITHUB PAGES:
1. Upload ke repository GitHub
2. Aktifkan Pages di Settings
3. Akses via username.github.io/repo

🔥 FIREBASE:
1. firebase init hosting
2. firebase deploy

📡 SURGE.SH:
1. npm install -g surge
2. surge (di folder aplikasi)

✅ Setelah online, bagikan URL ke guru untuk akses langsung!`;

            alert(instructions);
        }

        // Update today's attendance for admin
        function updateTodayAttendance() {
            const today = new Date().toDateString();
            const todayRecords = attendanceRecords.filter(r => 
                new Date(r.timestamp).toDateString() === today
            );
            
            const container = document.getElementById('todayAttendance');
            
            if (todayRecords.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-4">Belum ada absensi hari ini</div>';
                return;
            }
            
            container.innerHTML = todayRecords.map(record => {
                const time = new Date(record.timestamp).toLocaleTimeString('id-ID');
                
                return `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-medium text-blue-800">${record.userName}</div>
                                <div class="text-sm text-blue-600">${record.userSubject} - ${time}</div>
                            </div>
                            <div class="text-blue-600">✅</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update report
        function updateReport() {
            const today = new Date().toDateString();
            const todayRecords = attendanceRecords.filter(r => 
                new Date(r.timestamp).toDateString() === today
            );
            
            const uniqueTeachers = new Set(attendanceRecords.map(r => r.userName)).size;
            
            document.getElementById('totalToday').textContent = todayRecords.length;
            document.getElementById('totalTeachers').textContent = uniqueTeachers;
            document.getElementById('totalRecords').textContent = attendanceRecords.length;
            
            // Update table
            const tbody = document.getElementById('reportTable');
            
            if (attendanceRecords.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                            Belum ada data absensi
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = attendanceRecords
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 20) // Show last 20 records
                .map(record => {
                    const time = new Date(record.timestamp).toLocaleString('id-ID');
                    
                    return `
                        <tr>
                            <td class="border border-gray-300 px-4 py-2">${time}</td>
                            <td class="border border-gray-300 px-4 py-2">${record.userName}</td>
                            <td class="border border-gray-300 px-4 py-2">${record.userSubject}</td>
                            <td class="border border-gray-300 px-4 py-2">
                                <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">
                                    ${record.status}
                                </span>
                            </td>
                        </tr>
                    `;
                }).join('');
        }

        // Settings functions
        function updateSettings() {
            // Update last login time
            const lastLogin = localStorage.getItem('lastAdminLogin');
            if (lastLogin) {
                document.getElementById('lastLoginTime').textContent = new Date(lastLogin).toLocaleString('id-ID');
            }
            
            // Update statistics
            updateSettingsStats();
            
            // Update browser and platform info
            updateSystemInfo();
            
            // Load saved settings
            loadSettings();
            
            // Update admin app link
            updateAdminAppLink();
        }
        
        // Update admin app link
        function updateAdminAppLink() {
            const adminAppLinkElement = document.getElementById('adminAppLink');
            const currentUrl = window.location.href;
            adminAppLinkElement.textContent = currentUrl;
            
            // Generate QR Code
            generateQRCode(currentUrl);
        }
        
        // Generate QR Code for app link
        function generateQRCode(url) {
            const canvas = document.getElementById('qrCodeCanvas');
            if (canvas && typeof QRCode !== 'undefined') {
                QRCode.toCanvas(canvas, url, {
                    width: 150,
                    height: 150,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, function (error) {
                    if (error) {
                        console.error('QR Code generation failed:', error);
                        // Fallback: show text instead
                        const container = document.getElementById('qrCodeContainer');
                        container.innerHTML = '<div class="text-xs text-gray-500 p-4">QR Code tidak dapat dibuat</div>';
                    }
                });
            }
        }
        
        function updateSettingsStats() {
            const uniqueTeachers = new Set(attendanceRecords.map(r => r.userName)).size;
            const dataSize = Math.round(JSON.stringify({attendanceRecords, teacherProfile}).length / 1024);
            
            document.getElementById('totalAttendanceCount').textContent = attendanceRecords.length;
            document.getElementById('totalTeacherCount').textContent = uniqueTeachers;
            document.getElementById('dataStorageSize').textContent = dataSize + ' KB';
        }
        
        function updateSystemInfo() {
            const browserInfo = navigator.userAgent.split(' ').pop();
            const platformInfo = navigator.platform || 'Unknown';
            
            document.getElementById('browserInfo').textContent = browserInfo;
            document.getElementById('platformInfo').textContent = platformInfo;
        }
        
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('adminSettings') || '{}');
            
            document.getElementById('autoLogout').checked = settings.autoLogout !== false;
            document.getElementById('notificationSound').checked = settings.notificationSound !== false;
            document.getElementById('workStartTime').value = settings.workStartTime || '07:00';
            document.getElementById('workEndTime').value = settings.workEndTime || '16:00';
        }
        
        function saveSettings() {
            const settings = {
                autoLogout: document.getElementById('autoLogout').checked,
                notificationSound: document.getElementById('notificationSound').checked,
                workStartTime: document.getElementById('workStartTime').value,
                workEndTime: document.getElementById('workEndTime').value
            };
            
            localStorage.setItem('adminSettings', JSON.stringify(settings));
        }

        // Settings event listeners
        document.getElementById('autoLogout').addEventListener('change', saveSettings);
        document.getElementById('notificationSound').addEventListener('change', saveSettings);
        document.getElementById('workStartTime').addEventListener('change', saveSettings);
        document.getElementById('workEndTime').addEventListener('change', saveSettings);

        // Admin copy link to clipboard
        document.getElementById('adminCopyLink').addEventListener('click', async function() {
            const appLink = document.getElementById('adminAppLink').textContent;
            
            try {
                await navigator.clipboard.writeText(appLink);
                
                // Show success feedback
                const button = this;
                const originalText = button.textContent;
                button.textContent = '✅ Tersalin!';
                button.classList.remove('bg-purple-500', 'hover:bg-purple-600');
                button.classList.add('bg-green-500');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-green-500');
                    button.classList.add('bg-purple-500', 'hover:bg-purple-600');
                }, 2000);
                
            } catch (error) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = appLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                alert('Link berhasil disalin ke clipboard!');
            }
        });

        // Admin share link using Web Share API or fallback
        document.getElementById('adminShareLink').addEventListener('click', async function() {
            const appLink = document.getElementById('adminAppLink').textContent;
            const shareData = {
                title: 'Aplikasi Absensi Mobile - Install di HP',
                text: '📱 Install aplikasi absensi mobile ini di HP Anda untuk absen dengan mudah!',
                url: appLink
            };
            
            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                } else {
                    // Fallback: create WhatsApp share link
                    const message = encodeURIComponent(`📱 *Aplikasi Absensi Mobile*\n\n✅ Install aplikasi ini di HP untuk absen dengan mudah!\n\n🔗 Link: ${appLink}\n\n📲 *Cara Install:*\n\n*Android (Chrome/Edge):*\n1. Buka link di browser HP\n2. Tap menu (⋮) di pojok kanan atas\n3. Pilih "Tambahkan ke layar utama"\n4. Tap "Tambah" untuk konfirmasi\n\n*iPhone (Safari):*\n1. Buka link di Safari\n2. Tap tombol bagikan (📤) di bawah\n3. Scroll dan pilih "Tambah ke Layar Utama"\n4. Tap "Tambah" untuk konfirmasi\n\n✨ Setelah install, aplikasi akan muncul di layar utama HP seperti aplikasi lainnya!`);
                    const whatsappUrl = `https://wa.me/?text=${message}`;
                    window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
                }
            } catch (error) {
                // Final fallback: copy to clipboard
                try {
                    const fullMessage = `📱 Aplikasi Absensi Mobile\n\nInstall aplikasi ini di HP untuk absen dengan mudah!\n\nLink: ${appLink}\n\nCara Install:\n- Android: Buka di Chrome > Menu (⋮) > "Tambahkan ke layar utama"\n- iPhone: Buka di Safari > Bagikan (📤) > "Tambah ke Layar Utama"`;
                    await navigator.clipboard.writeText(fullMessage);
                    alert('Link dan instruksi install berhasil disalin! Paste di aplikasi chat untuk membagikan.');
                } catch (clipboardError) {
                    alert(`Bagikan link ini ke guru:\n\n${appLink}\n\nInstruksi install:\n- Android: Buka di Chrome > Menu > "Tambahkan ke layar utama"\n- iPhone: Buka di Safari > Bagikan > "Tambah ke Layar Utama"`);
                }
            }
        });

        // Export data
        document.getElementById('exportData').addEventListener('click', function() {
            const data = {
                attendanceRecords: attendanceRecords,
                teacherProfile: teacherProfile,
                exportDate: new Date().toISOString(),
                version: '1.0.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `absensi-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('✅ Data berhasil di-export!');
        });

        // Import data
        document.getElementById('importData').addEventListener('click', function() {
            document.getElementById('importFile').click();
        });

        document.getElementById('importFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = JSON.parse(event.target.result);
                    
                    if (confirm('⚠️ Import data akan mengganti semua data yang ada. Lanjutkan?')) {
                        if (data.attendanceRecords) {
                            attendanceRecords = data.attendanceRecords;
                            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
                        }
                        
                        if (data.teacherProfile) {
                            teacherProfile = data.teacherProfile;
                            localStorage.setItem('teacherProfile', JSON.stringify(teacherProfile));
                        }
                        
                        alert('✅ Data berhasil di-import!');
                        updateSettingsStats();
                        updateReport();
                        updateTodayAttendance();
                    }
                } catch (error) {
                    alert('❌ File tidak valid atau rusak!');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            e.target.value = '';
        });

        // Change password
        document.getElementById('changePassword').addEventListener('click', function() {
            document.getElementById('changePasswordModal').classList.remove('hidden');
        });

        document.getElementById('cancelChangePassword').addEventListener('click', function() {
            document.getElementById('changePasswordModal').classList.add('hidden');
            document.getElementById('changePasswordForm').reset();
        });

        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            const currentPassword = localStorage.getItem('adminPassword') || 'Admin1234';
            
            if (oldPassword !== currentPassword) {
                alert('❌ Password lama salah!');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('❌ Password baru minimal 6 karakter!');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('❌ Konfirmasi password tidak cocok!');
                return;
            }
            
            localStorage.setItem('adminPassword', newPassword);
            alert('✅ Password berhasil diubah!');
            
            document.getElementById('changePasswordModal').classList.add('hidden');
            document.getElementById('changePasswordForm').reset();
        });

        // Clear all data
        document.getElementById('clearAllData').addEventListener('click', function() {
            if (confirm('⚠️ PERINGATAN: Ini akan menghapus SEMUA data absensi dan profil guru. Tindakan ini tidak dapat dibatalkan!\n\nKetik "HAPUS SEMUA" untuk konfirmasi:')) {
                const confirmation = prompt('Ketik "HAPUS SEMUA" untuk konfirmasi:');
                if (confirmation === 'HAPUS SEMUA') {
                    localStorage.removeItem('attendanceRecords');
                    localStorage.removeItem('teacherProfile');
                    attendanceRecords = [];
                    teacherProfile = {};
                    
                    alert('✅ Semua data berhasil dihapus!');
                    updateSettingsStats();
                    updateReport();
                    updateTodayAttendance();
                    updateTeacherDashboard();
                } else {
                    alert('❌ Konfirmasi tidak sesuai. Data tidak dihapus.');
                }
            }
        });

        // Logout admin
        document.getElementById('logoutAdmin').addEventListener('click', function() {
            if (confirm('Yakin ingin logout dari admin?')) {
                adminAuthenticated = false;
                localStorage.removeItem('adminAuth');
                currentMode = 'teacher';
                localStorage.setItem('userMode', currentMode);
                
                updateAdminButtonVisibility();
                updateUIForMode();
                
                alert('✅ Berhasil logout dari admin!');
            }
        });

        // Update admin button visibility - always show admin button
        function updateAdminButtonVisibility() {
            const accessButton = document.getElementById('adminAccessButton');
            const modeToggle = document.getElementById('adminModeToggle');
            
            // Always show admin access button
            accessButton.classList.remove('hidden');
            
            if (adminAuthenticated) {
                modeToggle.classList.remove('hidden');
            } else {
                modeToggle.classList.add('hidden');
            }
        }

        // Initialize app
        function initializeApp() {
            // Setup PWA
            setupPWA();
            
            // Update admin button visibility based on authentication status
            updateAdminButtonVisibility();
            
            updateUIForMode();
            
            // Update time every second
            setInterval(updateCurrentTime, 1000);
            
            // Initialize current time
            updateCurrentTime();
            
            // Initialize app link
            updateAppLink();
        }

        // Start the app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9891308892790fad',t:'MTc1OTU0NDMxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
